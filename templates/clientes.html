{% extends "base.html" %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h2><i class="bi bi-people"></i> Clientes</h2>
    </div>
    <div class="col-auto">
        <a href="{{ url_for('novo_cliente') }}" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> Novo Cliente
        </a>
    </div>
</div>

<div class="card">
    <div class="card-body">
        {% if clientes %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Tipo</th>
                        <th>Documento</th>
                        <th>Data Cadastro</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for cliente in clientes %}
                    <tr>
                        <td><strong>{{ cliente.nome }}</strong></td>
                        <td>
                            <span class="badge bg-{% if cliente.tipo == 'PF' %}primary{% else %}success{% endif %}">
                                {{ 'Pessoa Física' if cliente.tipo == 'PF' else 'Pessoa Jurídica' }}
                            </span>
                        </td>
                        <td>{{ cliente.documento }}</td>
                        <td>{{ cliente.data_cadastro.strftime('%d/%m/%Y') }}</td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <a href="{{ url_for('historico_cliente', id=cliente.id) }}" class="btn btn-info" title="Histórico">
                                    <i class="bi bi-clock-history"></i>
                                </a>
                                <button onclick="confirmarExclusao({{ cliente.id }}, '{{ cliente.nome }}')" class="btn btn-danger" title="Excluir">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center py-5 text-muted">
            <i class="bi bi-person-x display-1"></i>
            <p class="mt-3">Nenhum cliente cadastrado</p>
            <a href="{{ url_for('novo_cliente') }}" class="btn btn-primary mt-2">
                Cadastrar Primeiro Cliente
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function confirmarExclusao(id, nome) {
        if (confirm(`Tem certeza que deseja excluir o cliente "${nome}"?\n\nAtenção: Não será possível excluir se houver documentos vinculados.`)) {
            fetch(`/cliente/${id}/deletar`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.sucesso) {
                    alert('Cliente excluído com sucesso!');
                    location.reload();
                } else {
                    alert('Erro: ' + data.erro);
                }
            })
            .catch(error => {
                alert('Erro ao excluir cliente');
            });
        }
    }
</script>
{% endblock %}